package keygen

import (
	"encoding/json"
	"github.com/okx/threshold-lib/crypto/paillier"
	"math/big"
)

const (
	DefaultPaillierKey = `{
			"Lambda": "12491739015082086670751919580842461171652786082158723041545076493462996646490003610605302802777412119329927033726828635409902134019877944906602965714864970529604742063787080934873286747232431342545971335838926321759710211991570450093942606043170942877300385053343839015918654129458983420596595246819194392854111575338454015961433748063441078688060996108945543514615722420391650063641038015752573298170417556349966872377465142891628772681073690793978159353600065167775468050866279892538995414180871018398048364043687607206451466730853469189831479021797816835285317147142571547569213925055462581722719747263209783840238",
			"P": "158141965208038634706786673379681980759259992630762691022551844842383008880024004400623684965820267730848900258578322907927868891577988115617218498903115357280160086046791365589867272497520443510763726092347599907311296179807337010399064509688218624190969067255198217728676213133323847103123033520299854914599",
			"Phi": "24983478030164173341503839161684922343305572164317446083090152986925993292980007221210605605554824238659854067453657270819804268039755889813205931429729941059209484127574161869746573494464862685091942671677852643519420423983140900187885212086341885754600770106687678031837308258917966841193190493638388785708223150676908031922867496126882157376121992217891087029231444840783300127282076031505146596340835112699933744754930285783257545362147381587956318707200130335550936101732559785077990828361742036796096728087375214412902933461706938379662958043595633670570634294285143095138427850110925163445439494526419567680476",
			"PublicKeyN": "24983478030164173341503839161684922343305572164317446083090152986925993292980007221210605605554824238659854067453657270819804268039755889813205931429729941059209484127574161869746573494464862685091942671677852643519420423983140900187885212086341885754600770106687678031837308258917966841193190493638388785708539273972354998302587665671840118643139411720339841374575681447397692287796788687196018812537314238740858156293681800360286405693056915543043387699088062014799697180777137582489576484033309360223631086742278679358045718614353623421718278707368631333401718041979499820374520625660304958416156593579513482897437",
			"Q": "157981330238927745013382871578279286258159509817991654321684761772009151634688651290248531230658858310075511280173191669100991439331545839469850492984816321968600992997786431821718383174046879916770632562555865037831488972839348031656256154084779038640114680439158507507416562416055947867594065532794060302363"
	}`
)

func NewPaillierKey() (*paillier.PrivateKey, error) {
	pKey, _, err := paillier.NewKeyPair(8)
	return pKey, err
}

func MarshalPaillierKey(key *paillier.PrivateKey) ([]byte, error) {
	m := make(map[string]string)
	m["PublicKeyN"] = key.PublicKey.N.String()
	m["Lambda"] = key.Lambda.String()
	m["Phi"] = key.Phi.String()
	m["P"] = key.P.String()
	m["Q"] = key.Q.String()
	return json.Marshal(m)
}

func UnMarshalToPaillierKey(bs []byte) (*paillier.PrivateKey, error) {
	m := make(map[string]string)
	err := json.Unmarshal(bs, &m)
	if err != nil {
		return nil, err
	}

	pKey := new(paillier.PrivateKey)
	pKey.PublicKey.N = new(big.Int)
	pKey.PublicKey.N.SetString(m["PublicKeyN"], 10)
	pKey.Lambda = new(big.Int)
	pKey.Lambda.SetString(m["Lambda"], 10)
	pKey.Phi = new(big.Int)
	pKey.Phi.SetString(m["Phi"], 10)
	pKey.P = new(big.Int)
	pKey.P.SetString(m["P"], 10)
	pKey.Q = new(big.Int)
	pKey.Q.SetString(m["Q"], 10)

	return pKey, nil
}
